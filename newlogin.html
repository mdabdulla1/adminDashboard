<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login</title>
  <link rel="stylesheet" href="newlogin.css">
  <link rel="icon" type="image/jpg" href="images/favicon.jpg">
</head>
<body>
<header>
<img src="dodla.jpg" alt="DairyFarm"/>
</header>
  <div class="container">
    <h2>Login</h2>
    <form id="login-form">
      <!-- Radio buttons for login type -->
      <div>
        <input type="radio" id="admin-login" name="login-type" value="admin" required>
        <label for="admin-login">Admin Login</label>

        <input type="radio" id="customer-login" name="login-type" value="customer" required>
        <label for="customer-login">Customer Login</label>
      </div>

      <label for="identifier">Email or Phone Number</label>
      <input type="text" id="identifier" name="identifier" placeholder="Enter email or phone no">

      <label for="password">Password</label>
      <input type="password" id="password" name="password" placeholder="Enter password" required>

      <div>
        <input type="checkbox" id="remember-me" name="remember-me">
        <label for="remember-me">Remember Me</label>
      </div>

      <button type="submit">Login</button>
    </form>

    <!-- Forgot Password link, hidden for Admin login -->
    <p id="forgot-password-container" style="display: none;">
      <a href="#" id="forgot-password">Forgot Password?</a>
    </p>

    <!-- Register link, hidden for Admin login -->
    <p id="register-link-container">
      Don't have an account? <a href="newregister.html">Register here</a>
    </p>
  </div>

  <!-- Forgot Password Modal -->
  <div id="forgot-password-modal" class="modal" style="display: none;">
    <div class="modal-content">
      <h3>Reset Password</h3>
      <form id="reset-password-form">
        <label for="reset-email">Enter Email</label>
        <input type="email" id="reset-email" required>

        <button type="button" id="send-otp">Send OTP</button>

        <div id="otp-section" style="display: none;">
          <label for="otp-code">Enter OTP</label>
          <input type="text" id="otp-code" required>
          <button type="button" id="verify-otp">Verify OTP</button>
        </div>

        <div id="new-password-section" style="display: none;">
          <label for="new-password">New Password</label>
          <input type="password" id="new-password" required>

          <label for="confirm-password">Confirm Password</label>
          <input type="password" id="confirm-password" required>

          <button type="submit">Reset Password</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // Admin credentials
    const adminCredentials = {
      email: "admin@dairyfarm.com",
      phone: "1234567890",
      password: "admin123"
    };

    // Remember Me feature
    document.addEventListener('DOMContentLoaded', function () {
      const savedIdentifier = localStorage.getItem('rememberedIdentifier');
      if (savedIdentifier) {
        document.getElementById('identifier').value = savedIdentifier;
        document.getElementById('remember-me').checked = true;
      }

      // Show or hide forgot password and register link based on login type
      document.querySelectorAll('input[name="login-type"]').forEach((radio) => {
        radio.addEventListener('change', function () {
          const loginType = document.querySelector('input[name="login-type"]:checked').value;
          const forgotPasswordContainer = document.getElementById('forgot-password-container');
          const registerLinkContainer = document.getElementById('register-link-container');
          
          if (loginType === 'admin') {
            // Hide forgot password and register link for admin login
            forgotPasswordContainer.style.display = 'none';
            registerLinkContainer.style.display = 'none';
          } else {
            // Show forgot password and register link for customer login
            forgotPasswordContainer.style.display = 'block';
            registerLinkContainer.style.display = 'block';
          }
        });
      });
    });

    document.getElementById('login-form').addEventListener('submit', function (e) {
      e.preventDefault();

      const loginType = document.querySelector('input[name="login-type"]:checked').value;
      const identifier = document.getElementById('identifier').value;
      const password = document.getElementById('password').value;
      const rememberMe = document.getElementById('remember-me').checked;

      if (loginType === 'admin') {
        // Admin login validation
        if (
          (identifier === adminCredentials.email || identifier === adminCredentials.phone) &&
          password === adminCredentials.password
        ) {
          alert('Admin login successful!');
          window.location.href = 'newdashboard.html'; // Redirect to admin dashboard
        } else {
          alert('Invalid admin credentials.');
        }
      } else {
        // Customer login validation
        const userData = localStorage.getItem(identifier);
        if (!userData) {
          alert('No account found with this email or phone number.');
          return;
        }

        const user = JSON.parse(userData);

        if (user.password !== password) {
          alert('Incorrect password.');
          return;
        }

        if (rememberMe) {
          localStorage.setItem('rememberedIdentifier', identifier);
        } else {
          localStorage.removeItem('rememberedIdentifier');
        }

        alert('Customer login successful!');
        window.location.href = 'index.html'; // Redirect to customer home page
      }
    });

    // Forgot Password functionality
    document.getElementById('forgot-password').addEventListener('click', function () {
      document.getElementById('forgot-password-modal').style.display = 'block';
    });

    // Handle sending OTP
    document.getElementById('send-otp').addEventListener('click', function () {
      const resetEmail = document.getElementById('reset-email').value;

      if (!localStorage.getItem(resetEmail)) {
        alert('No account found with this email.');
        return;
      }

      // Generate a random 6-digit OTP
      const otp = Math.floor(100000 + Math.random() * 900000);
      localStorage.setItem('otp', otp);
      localStorage.setItem('resetEmail', resetEmail);
      alert(`Your OTP is: ${otp}`); // In real implementation, send this via email service

      document.getElementById('otp-section').style.display = 'block';
    });

    // Handle verifying OTP
    document.getElementById('verify-otp').addEventListener('click', function () {
      const enteredOtp = document.getElementById('otp-code').value;
      const storedOtp = localStorage.getItem('otp');

      if (enteredOtp === storedOtp) {
        alert('OTP verified successfully.');
        document.getElementById('new-password-section').style.display = 'block';
      } else {
        alert('Invalid OTP. Please try again.');
      }
    });

    // Handle resetting password
    document.getElementById('reset-password-form').addEventListener('submit', function (e) {
      e.preventDefault();

      const newPassword = document.getElementById('new-password').value;
      const confirmPassword = document.getElementById('confirm-password').value;
      const resetEmail = localStorage.getItem('resetEmail');

      if (newPassword !== confirmPassword) {
        alert('Passwords do not match.');
        return;
      }

      const userData = JSON.parse(localStorage.getItem(resetEmail));
      userData.password = newPassword;
      localStorage.setItem(resetEmail, JSON.stringify(userData));

      // Clean up stored data
      localStorage.removeItem('otp');
      localStorage.removeItem('resetEmail');

      alert('Password reset successfully! You can now log in with your new password.');
      document.getElementById('forgot-password-modal').style.display = 'none';
    });
  </script>
</body>
</html>
